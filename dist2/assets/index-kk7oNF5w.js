import{z as f,u as h,j as e,U as _,r as m,bh as o,B as C,bi as $}from"./index-DPJpM76q.js";import{b as p}from"./utils-ClR9-_0P.js";import{T as I}from"./trending-up-ZQp6ToFz.js";import{B as T}from"./button-lO7XdXyl.js";import{L as S}from"./index-BCC9mltJ.js";import"./useSize-DND3t0aL.js";import"./index-Bu88h86I.js";import"./index-BV9ecpN8.js";import"./PurePanel-DmuLXhi4.js";import"./index-WMb-X793.js";import"./useMergedState-CSfwPUM-.js";import"./EllipsisOutlined-BD0YvPch.js";import"./Overflow-Cjb5NB4R.js";import"./roundedArrow-ySD6W0-A.js";import"./context-C9R0sSvt.js";import"./index--7a_W_9H.js";import"./collapse-BbEVqHco.js";import"./index-Da3FNLPO.js";/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]],O=f("ArrowUpRight",B);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],E=f("DollarSign",A);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],M=f("Target",q);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]],z=f("TrendingDown",R),U=({title:r,value:t,icon:s,iconBgColor:n,iconColor:i,suffix:a})=>{const{t:d}=h();return e.jsx("div",{className:"bg-white rounded-xl shadow-sm p-4 border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-base font-medium text-gray-600 h-10 flex items-center",children:d(r)}),e.jsxs("p",{className:"text-lg font-bold text-gray-900 h-8 flex items-center",children:[typeof t=="number"?p(t):t,a&&` ${d(a)}`]})]}),e.jsx("div",{className:`p-3 ${n} rounded-full`,children:e.jsx("div",{className:`h-6 w-6 ${i}`,children:s})})]})})},Q=({baseData:r})=>{var a,d,l,c,u;if(!(r!=null&&r.data1))return null;const{t}=h(),s=r.data1,n=((a=s.total_prices)==null?void 0:a.kelishuv_value)/((d=s.total_prices)==null?void 0:d.price)*100||0,i=[{title:"Total Earned",value:((l=s.total_prices)==null?void 0:l.price)||0,icon:e.jsx(I,{}),iconBgColor:"bg-green-100",iconColor:"text-green-600",suffix:"so'm"},{title:"Expected Additional Payments",value:((c=s.total_prices)==null?void 0:c.qolgan_qarz)||0,icon:e.jsx(z,{}),iconBgColor:"bg-orange-100",iconColor:"text-orange-600",suffix:"so'm"},{title:"Total Agreed",value:((u=s.total_prices)==null?void 0:u.kelishuv_value)||0,icon:e.jsx(M,{}),iconBgColor:"bg-indigo-100",iconColor:"text-indigo-600",suffix:"so'm"},{title:"Total Leads",value:s.total_leads+" "+t("ta")||0,icon:e.jsx(_,{}),iconBgColor:"bg-blue-100",iconColor:"text-blue-600"},{title:"Average Conversion",value:`${n.toFixed(1)}%`,icon:e.jsx(E,{}),iconBgColor:"bg-purple-100",iconColor:"text-purple-600"}];return e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-8",children:i.map((j,N)=>e.jsx(U,{...j},N))})},F=({operator:r,tableData:t,isSelected:s,onSelect:n})=>{const{t:i}=h(),a=t.agreedPrice==="-"||t.totalPrice==="-"?0:isFinite(Number(t.totalPrice)/Number(t.agreedPrice)*100)?Number(t.totalPrice)/Number(t.agreedPrice)*100:0,d=()=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),e.jsx("div",{className:"animate-pulse bg-gray-200 h-4 w-8 rounded"})]});return e.jsxs("tr",{className:`hover:bg-gray-50 transition-colors cursor-pointer ${s?"bg-blue-50 border-l-4 border-blue-500":""}`,onClick:()=>n(r.id),children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:r.id}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[r.name," ",r.last_name]}),e.jsx("div",{className:"text-sm text-gray-500",children:r.email})]})})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.isLoading?e.jsx(d,{}):t.totalLeads}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-semibold text-blue-600",children:t.isLoading?e.jsx("div",{className:"animate-pulse bg-gray-200 h-4 w-12 rounded"}):`${p(t.agreedPrice)} ${i("so'm")}`}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-semibold text-green-600",children:t.isLoading?e.jsx("div",{className:"animate-pulse bg-gray-200 h-4 w-12 rounded"}):`${p(t.totalPrice)} ${i("so'm")}`}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-semibold text-orange-600",children:t.isLoading?e.jsx("div",{className:"animate-pulse bg-gray-200 h-4 w-12 rounded"}):`${p(t.remainingPrice)} ${i("so'm")}`}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-semibold text-indigo-600",children:t.isLoading?e.jsx("div",{className:"animate-pulse bg-gray-200 h-4 w-12 rounded"}):`${a.toFixed(1)}%`})]})},G=({operators:r,selectedOperator:t,onOperatorSelect:s,getTableData:n,isLoading:i})=>{const{t:a}=h(),d=l=>{s(t===l?null:l)};return i?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:a("Loading operators...")})]}):e.jsx("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden border border-gray-200",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-500  tracking-wider",children:a("ID")}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-500  tracking-wider",children:a("Operator")}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-500  tracking-wider",children:a("Total Leads")}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-500  tracking-wider",children:a("Agreed Price")}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-500  tracking-wider",children:a("Paid Price")}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-500  tracking-wider",children:a("Remaining Price")}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-500  tracking-wider",children:a("Progress")})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:r.map(l=>e.jsx(F,{operator:l,tableData:n(l),isSelected:t===l.id,onSelect:d},l.id))})]})})})},H=({deal:r})=>{const t=s=>{const n={Online:{bg:"bg-green-100",text:"text-green-700",width:"w-[70px]"},Offline:{bg:"bg-blue-100",text:"text-blue-700",width:"w-[73px]"},default:{bg:"bg-gray-100",text:"text-gray-700",width:"w-[80px]"}},i=s==="Online"||s==="Offline"?n[s]:n.default;return e.jsx("p",{className:`${i.bg} ${i.text} ${i.width} text-center px-3 py-1 rounded-full text-sm font-medium`,children:s})};return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-2 py-3 text-sm text-gray-900",children:r.id}),e.jsx("td",{className:"px-2 py-3 text-sm text-gray-900 font-medium max-w-[200px] break-words",children:r.name}),e.jsx("td",{className:"px-2 py-3 text-sm text-gray-500",children:r.kurs_turi}),e.jsx("td",{className:"px-2 py-3 text-sm text-gray-500",children:t(r.pipline)}),e.jsx("td",{className:"px-2 py-3 text-sm font-semibold text-indigo-600",children:p(r.kelishuv_value)}),e.jsx("td",{className:"px-2 py-3 text-sm text-green-600",children:p(r.price)}),e.jsx("td",{className:"px-2 py-3 text-sm font-semibold text-orange-600",children:p(r.qolgan_qarz)}),e.jsx("td",{className:"px-2 py-3 text-sm text-gray-500",children:e.jsx(T,{className:"p-2",onClick:()=>{window.open(`https://najotnur01.amocrm.ru/leads/detail/${r.id}`,"_blank")},children:e.jsx(O,{className:"h-5 w-5"})})})]})},J=({selectedOperator:r,selectedOperatorData:t,selectedDashboardData:s})=>{var a,d;const{t:n}=h();if(!r||!(s!=null&&s.data))return null;const i=((a=s.data)==null?void 0:a.data2)&&((d=s.data.data2)==null?void 0:d.length)>0;return e.jsxs("div",{className:"mt-8 bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:[n("Operator Details"),": ",t==null?void 0:t.name," ",t==null?void 0:t.last_name]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[n("ID"),": ",r]})]}),i?e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-3 text-left text-xs font-bold text-gray-500",children:n("ID")}),e.jsx("th",{className:"px-2 py-3 text-left text-xs font-bold text-gray-500",children:n("Name")}),e.jsx("th",{className:"px-2 py-3 text-left text-xs font-bold text-gray-500",children:n("Course type")}),e.jsx("th",{className:"px-2 py-3 text-left text-xs font-bold text-gray-500",children:n("Pipline")}),e.jsx("th",{className:"px-2 py-3 text-left text-xs font-bold text-gray-500",children:n("Agreed")}),e.jsx("th",{className:"px-2 py-3 text-left text-xs font-bold text-gray-500",children:n("Price")}),e.jsx("th",{className:"px-2 py-3 text-left text-xs font-bold text-gray-500",children:n("Remaining")}),e.jsx("th",{className:"px-2 py-3 text-left text-xs font-bold text-gray-500",children:n("Actions")})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:s.data.data2.map(l=>e.jsx(H,{deal:l},l.id))})]})})}):e.jsx("div",{className:"p-8 text-center text-gray-500",children:e.jsx("p",{children:n("No data to display")})})]})},K=r=>{const t=m.useMemo(()=>{const i=Array.from(new Set(r.map(a=>a.id))).slice(0,15);for(;(i==null?void 0:i.length)<15;)i.push(null);return i},[r]),s=[o({operatorId:t[0]},{skip:t[0]===null}),o({operatorId:t[1]},{skip:t[1]===null}),o({operatorId:t[2]},{skip:t[2]===null}),o({operatorId:t[3]},{skip:t[3]===null}),o({operatorId:t[4]},{skip:t[4]===null}),o({operatorId:t[5]},{skip:t[5]===null}),o({operatorId:t[6]},{skip:t[6]===null}),o({operatorId:t[7]},{skip:t[7]===null}),o({operatorId:t[8]},{skip:t[8]===null}),o({operatorId:t[9]},{skip:t[9]===null}),o({operatorId:t[10]},{skip:t[10]===null}),o({operatorId:t[11]},{skip:t[11]===null}),o({operatorId:t[12]},{skip:t[12]===null}),o({operatorId:t[13]},{skip:t[13]===null}),o({operatorId:t[14]},{skip:t[14]===null})],n=m.useMemo(()=>t.map((i,a)=>({data:s[a].data,operatorId:i,isLoading:s[a].isLoading,error:s[a].error})).filter(i=>i.operatorId!==null),[s,t]);return{allDashboardData:n,getDashboardDataById:i=>n.find(a=>a.operatorId===i)}},me=()=>{const[r,t]=m.useState(""),[s,n]=m.useState(null),{t:i}=h();console.log(t);const{data:a,isLoading:d}=C({per_page:500,search:r}),{data:l}=$(),c=(a==null?void 0:a.data)||[],{getDashboardDataById:u}=K(c);m.useEffect(()=>{(c==null?void 0:c.length)>0&&!s&&n(c[0].id)},[c,s]);const j=m.useMemo(()=>c.filter(g=>g.name.toLowerCase().includes(r.toLowerCase())||g.last_name.toLowerCase().includes(r.toLowerCase())),[c,r]),N=m.useMemo(()=>c.find(g=>g.id===s),[c,s]),L=g=>{var b,w,v,k;const x=u(g.id);if(x!=null&&x.error)return{totalLeads:0,agreedPrice:0,remainingPrice:0,totalPrice:0,isLoading:!1,hasError:!0};if(x!=null&&x.isLoading)return{totalLeads:0,agreedPrice:0,remainingPrice:0,totalPrice:0,isLoading:!0,hasError:!1};if(!((b=x==null?void 0:x.data)!=null&&b.data1))return{totalLeads:0,agreedPrice:0,remainingPrice:0,totalPrice:0,isLoading:!1,hasError:!1};const y=x.data.data1;return{totalLeads:y.total_leads||0,agreedPrice:((w=y.total_prices)==null?void 0:w.kelishuv_value)||0,remainingPrice:((v=y.total_prices)==null?void 0:v.qolgan_qarz)||0,totalPrice:((k=y.total_prices)==null?void 0:k.price)||0,isLoading:!1,hasError:!1}},P=s?u(s):null;return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b border-gray-200",children:e.jsxs("div",{className:"mx-auto flex items-center justify-between px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"py-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:i("Operator statistics")}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:i("Performance and financial performance monitoring")})]}),e.jsx(S,{})]})}),e.jsxs("div",{className:"mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx(Q,{baseData:l}),e.jsx(G,{operators:j,selectedOperator:s,onOperatorSelect:n,getTableData:L,isLoading:d}),e.jsx(J,{selectedOperator:s,selectedOperatorData:N,selectedDashboardData:P})]})]})};export{me as default};
